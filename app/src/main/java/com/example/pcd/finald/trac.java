package com.example.pcd.finald;import android.*;import android.annotation.SuppressLint;import android.app.Fragment;import android.app.ProgressDialog;import android.content.Context;import android.content.Intent;import android.content.pm.PackageManager;import android.location.Location;import android.location.LocationListener;import android.location.LocationManager;import android.net.Uri;import android.os.AsyncTask;import android.os.Bundle;import android.support.annotation.Nullable;import android.support.v4.app.ActivityCompat;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Button;import android.widget.EditText;import android.widget.Toast;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import java.io.IOException;import java.util.HashMap;import java.util.Timer;import java.util.TimerTask;/** * Created by PCD on 9/23/2017. */@SuppressLint("ValidFragment")class trac extends Fragment {    EditText e;   Button map;    String latitude;    String longitude;    String s;    @Nullable    @Override    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, Bundle savedInstanceState) {        View v =inflater.inflate(R.layout.trac,container,false);       e=(EditText)v.findViewById(R.id.bus_nmber);        map=(Button)v.findViewById(R.id.t_map);        getActivity().setTitle("Trace your bus");        map.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                s=e.getText().toString();                new getbus().execute();                if(s.length()==0){                    Toast.makeText(getActivity(), "Please enter bus Id", Toast.LENGTH_SHORT).show();                }            }        });        return v;    }    private class getbus extends AsyncTask<Void,Void,Void>{        HashMap<String,String> map;        String res,url1;        ProgressDialog pd;        @Override        protected void onPreExecute() {            super.onPreExecute();            map=new HashMap<>();            pd=new ProgressDialog(getActivity());            pd.setMessage("Please Wait");            pd.setIndeterminate(true);            pd.setCancelable(false);            pd.show();            url1=getResources().getString(R.string.url)+"getbus_id.php";        }        @Override        protected Void doInBackground(Void... voids) {            map.put("bus_id",s);            servicehandler sh = new servicehandler();            try {                res = sh.getData(url1, map);            } catch (IOException e) {                e.printStackTrace();            }            try {                JSONObject JO = new JSONObject(res);                JSONArray ja = JO.getJSONArray("data");                for(int i=0;i<ja.length();i++){                    JSONObject jo1= ja.getJSONObject(i);                    longitude=jo1.getString("long");                    latitude = jo1.getString("late");                }            } catch (JSONException e1) {                e1.printStackTrace();            }            return null;        }        @Override        protected void onPostExecute(Void aVoid) {            super.onPostExecute(aVoid);            if(pd.isShowing()){                pd.dismiss();            }                Intent intent = new Intent(android.content.Intent.ACTION_VIEW, Uri.parse("http://maps.google.com/maps?daddr=" + latitude + "," + longitude));                startActivity(intent);        }    }}